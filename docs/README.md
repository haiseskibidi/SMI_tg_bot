# 🤖 Telegram News Monitor Bot

Профессиональная система автоматического мониторинга новостных каналов с современным Telegram интерфейсом и интеллектуальными алертами.

## 🚀 Ключевые возможности

### 📱 **Современный UX интерфейс**
- ⌨️ **Автокомплит команд** - все команды показываются при вводе `/`
- ✏️ **Автоматическое редактирование** - чистый интерфейс без спама сообщениями  
- 📄 **Пагинация каналов** - удобный просмотр больших списков (8 каналов на страницу)
- 🎮 **Inline кнопки** - быстрая навигация по всем функциям

### 🗂️ **Управление каналами**
- ➕ **Быстрое добавление каналов** - через ссылку, forward или массово
- 🗑️ **Удаление каналов** - безопасное удаление с подтверждением
- 📂 **Группировка по регионам** - автоматическая сортировка каналов
- 🔄 **Обновление в реальном времени** - мгновенное обновление списков

### 🌍 **Динамические регионы**
- ➕ **Создание новых регионов** - прямо через интерфейс бота
- 🎨 **Выбор эмодзи** - из готового списка или свой
- 🔍 **Автоопределение региона** - по ключевым словам в названии канала
- 📊 **Статистика регионов** - количество каналов в каждом регионе

### 🚨 **Умные алерты**
- 🔥 **Критические события** - пожары, ДТП, ЧС (красный приоритет)
- ⚠️ **Важные новости** - погода, транспорт, власть (желтый приоритет)
- 📰 **Общие новости** - социальные, спортивные события
- 🎯 **Настраиваемые ключевые слова** - для каждой категории

### ⚡ **Технические преимущества**
- 💾 **Кэширование подписок** - быстрый запуск без проверки всех каналов
- 🎯 **Сортировка по темам** - автоматическая отправка в нужные топики Telegram групп
- 📊 **SQLite база данных** - статистика сообщений и работы бота
- 🔄 **Автоматический рестарт** - обновления через Telegram интерфейс

## 📋 Системные требования

### Минимальные требования
- **ОС**: Ubuntu 18.04+ / Debian 10+ / Windows 10+
- **RAM**: 512MB (рекомендуется 1GB)
- **CPU**: 1 core
- **Диск**: 2GB свободного места
- **Интернет**: стабильное соединение

### API ключи
- **Telegram API**: api_id и api_hash с [my.telegram.org](https://my.telegram.org)
- **Telegram Bot Token**: токен бота через [@BotFather](https://t.me/BotFather)

## 🚀 Быстрая установка

### 1. Клонирование и настройка

```bash
# Клонируем репозиторий
git clone <your-repo-url> telegram-news-monitor
cd telegram-news-monitor

# Устанавливаем зависимости
pip install -r requirements.txt
```

### 2. Конфигурация

**config/config.yaml:**
```yaml
telegram:
  api_id: 12345678                           # Ваш API ID
  api_hash: "your_api_hash_here"             # Ваш API Hash
  bot_token: "your_bot_token_here"           # Токен бота

output:
  target_group: -1001234567890               # ID группы для отправки новостей
  topics:                                    # ID топиков в группе
    sakhalin: 2
    kamchatka: 5  
    chita: 32
    general: null                            # Общий чат (без топика)

alerts:
  critical:                                  # Критические алерты (🔴)
    keywords: ["пожар", "дтп", "чс", "авария", "взрыв"]
    emoji: "🔴"
    priority: "high"
    
  important:                                 # Важные алерты (🟡)  
    keywords: ["власть", "транспорт", "погода", "шторм"]
    emoji: "🟡"
    priority: "medium"

regions:                                     # Динамические регионы
  sakhalin:
    name: "🏝️ Сахалин"
    emoji: "🏝️"
    description: "Сахалинская область"
    keywords: ["сахалин", "южно", "корсаков", "невельск"]
    topic_id: 2
    created_at: "2025-01-15"
```

**config/channels_config.yaml:**
```yaml
regions:
  sakhalin:
    name: "🏝️ Сахалин"
    channels:
      - username: "sakhalin_news"
        title: "Сахалин Новости"
      - username: "yuzhno_city"
        title: "Южно-Сахалинск"
        
  kamchatka:
    name: "🌋 Камчатка"  
    channels:
      - username: "kamchatka_news"
        title: "Камчатка Сегодня"
```

### 3. Запуск

```bash
# Прямой запуск (разработка)
python main_bot.py

# Или в фоне (продакшен)
nohup python main_bot.py &
```

## 📱 Команды бота

### Основные команды
- 🏠 `/start` - Главное меню
- 📊 `/status` - Статус системы
- 🗂️ `/manage_channels` - Управление каналами
- ➕ `/add_channel` - Добавить канал
- 📈 `/stats` - Статистика работы

### Управление системой
- 🚀 `/start_monitoring` - Запустить мониторинг
- 🛑 `/stop_monitoring` - Остановить мониторинг  
- 🔄 `/restart` - Перезапустить систему
- ⚙️ `/settings` - Настройки интерфейса

### Утилиты
- 📂 `/topic_id` - Узнать ID темы в группе
- 🆘 `/help` - Справка по командам

## 🎮 Интерфейс бота

### 🗂️ Управление каналами

**Главный экран:**
```
🗂️ Управление каналами

📊 Всего каналов: 25
📂 Регионов: 4

🏝️ Сахалин (8)
🌋 Камчатка (6)  
🏔️ Чита (7)
📰 Общие (4)

➕ Добавить канал    🔄 Обновить
🏠 Главное меню
```

**Просмотр региона с пагинацией:**
```
📂 🏝️ Сахалин

📊 Каналов в регионе: 25
📄 Страница: 1 из 4

📋 Список каналов:
1. @sakhalin_news
   📄 Сахалин Новости
🗑️ Удалить @sakhalin_news

2. @yuzhno_news
   📄 Южно-Сахалинск  
🗑️ Удалить @yuzhno_news

◀️ Назад    📄 1/4    ▶️ Далее
```

### ➕ Добавление каналов

**3 способа добавления:**

1. **По ссылке** - отправь ссылку: `https://t.me/news_channel`
2. **Forward сообщений** - перешли любое сообщение из канала
3. **Массовое добавление** - отправь несколько ссылок сразу

**Автоматическое определение региона:**
```
📺 Найден новый канал!

📋 Название: Владивосток Новости
🔗 Username: @vladivostok_news

🎯 Предлагаемый регион: 🌊 Приморье (найдено: владивосток)

🏝️ Сахалин        🌋 Камчатка
🏔️ Чита           📰 Общие

➕ Создать новый регион
❌ Отмена
```

### 🌍 Создание новых регионов

**Шаг 1 - Название:**
```
➕ Создание нового региона

📝 Шаг 1 из 2: Название региона

Отправьте название региона:

Примеры:
• Владивосток
• Магадан  
• Иркутск

💡 На следующем шаге выберете эмодзи!
```

**Шаг 2 - Эмодзи:**
```
🎨 Шаг 2 из 2: Выбор эмодзи

📋 Регион: Владивосток

Выберите эмодзи для региона:

🌊 🏔️ 🌲 ❄️
🌋 🏝️ 🏜️ 🌾  
🏞️ 🌸 ⚡ 🚢

✏️ Ввести свой эмодзи
❌ Отмена
```

### 🗑️ Удаление каналов

**Безопасное удаление с подтверждением:**
```
🗑️ Подтверждение удаления

📂 Регион: 🏝️ Сахалин
📺 Канал: @sakhalin_news
📄 Название: Сахалин Новости

⚠️ Вы уверены, что хотите удалить этот канал?

❌ Это действие НЕОБРАТИМО!
🛑 Мониторинг канала будет остановлен
📊 История сообщений сохранится в базе данных

✅ Да, удалить    ❌ Отмена
```

## 📊 Статистика и мониторинг

### Статистика работы
```
📈 Статистика за сегодня

📊 Всего сообщений: 1,247
📤 Отобрано: 89 (7.1%)
🎯 Процент отбора: ↗️ +2.3%

⏰ Последнее обновление: 14:25:17

📊 Статус    🗑️ Очистить статистику
🏠 Главное меню
```

### Системный статус
```
📊 Статус системы

📱 Telegram бот: ✅ Активен
🗄️ База данных: ✅ Подключена  
📺 Мониторинг каналов: ✅ Активен (47 каналов)
💾 Кэш подписок: ✅ Загружен (47 каналов)

🔄 Последний перезапуск: 12:30:45
⚡ Время работы: 2ч 15мин

🗂️ Управление каналами    📈 Статистика
🏠 Главное меню
```

## 🚨 Система алертов

### Категории алертов

**🔴 Критические (высокий приоритет):**
- Пожары, взрывы, ЧС
- ДТП с пострадавшими
- Стихийные бедствия

**🟡 Важные (средний приоритет):**
- Решения властей
- Транспортные происшествия  
- Погодные предупреждения

**📰 Общие (обычный приоритет):**
- Социальные события
- Спортивные новости
- Культурные мероприятия

### Формат алертов

```
🔴 КРИТИЧЕСКИЙ АЛЕРТ

🔥 Пожар на складе в Южно-Сахалинске
📍 Источник: @sakhalin_news
⏰ 14:25

[Текст сообщения...]

#пожар #ЧС #сахалин
```

## ⚡ Технические особенности

### Кэширование подписок
- **Быстрый старт** - не проверяет подписки на уже известные каналы
- **Автоматическое обновление** - добавляет новые каналы в кэш
- **Файл кэша** - `config/subscriptions_cache.json`

### Автоматическое редактирование сообщений
- **Inline кнопки** - редактируют то же сообщение
- **Reply кнопки** - создают новые сообщения (стандартное поведение)
- **Чистый интерфейс** - без спама сообщениями

### Пагинация
- **8 каналов на страницу** - оптимально для мобильных экранов
- **Навигация** - ◀️ Назад / ▶️ Далее
- **Индикатор** - 📄 2/5 (текущая страница из общего количества)

## 🛠️ Конфигурация

### Структура config.yaml

```yaml
telegram:
  api_id: int                    # Telegram API ID  
  api_hash: str                  # Telegram API Hash
  bot_token: str                 # Bot Token от @BotFather
  phone: str                     # Номер телефона (опционально)

output:
  target_group: int              # ID группы для отправки новостей
  topics:                        # Соответствие регион -> topic_id
    region_key: topic_id         # null для общего чата

alerts:
  category_name:                 # Категория алертов
    keywords: [str]              # Ключевые слова для поиска
    emoji: str                   # Эмодзи для категории  
    priority: str                # Приоритет: high/medium/low

regions:                         # Динамические регионы
  region_key:
    name: str                    # Отображаемое название с эмодзи
    emoji: str                   # Эмодзи региона
    description: str             # Описание региона
    keywords: [str]              # Ключевые слова для автоопределения
    topic_id: int                # ID топика в группе (опционально)
    created_at: str              # Дата создания

database:
  path: str                      # Путь к файлу базы данных
  backup_interval: int           # Интервал резервного копирования (часы)
```

### Структура channels_config.yaml

```yaml
regions:
  region_key:                    # Ключ региона из config.yaml
    name: str                    # Название региона
    channels:                    # Список каналов региона
      - username: str            # Username канала (без @)
        title: str               # Название канала
```

## 📁 Структура проекта

```
telegram-news-monitor/
├── main_bot.py                # 🚀 Главный файл запуска
├── requirements.txt           # 📦 Python зависимости
├── README.md                  # 📖 Документация
├── config/
│   ├── config.yaml           # ⚙️ Основная конфигурация
│   ├── channels_config.yaml  # 📺 Конфигурация каналов
│   └── subscriptions_cache.json  # 💾 Кэш подписок
├── src/
│   ├── telegram_bot.py       # 🤖 Telegram Bot API
│   ├── database.py           # 💾 SQLite база данных  
│   └── news_processor.py     # 📰 Обработка новостей
├── logs/
│   └── news_monitor.log      # 📝 Логи приложения
└── docs/
    ├── README.md             # 📚 Документация
    └── CREATE_BOT.md         # 🆕 Создание бота
```

## 🔧 Команды для управления

### Запуск и остановка
```bash
# Запуск
python main_bot.py

# Запуск в фоне  
nohup python main_bot.py &

# Остановка
# Ctrl+C или команда /restart в боте
```

### Просмотр логов
```bash
# Все логи
tail -f logs/news_monitor.log

# Только ошибки
grep ERROR logs/news_monitor.log

# Статистика работы
grep "📊" logs/news_monitor.log | tail -20
```

### Обслуживание базы данных
```bash
# Подключение к базе
sqlite3 news_monitor.db

# Основные запросы
.tables                        # Список таблиц
SELECT COUNT(*) FROM messages; # Количество сообщений
.quit                          # Выход
```

## 🔐 Безопасность

### Рекомендации по безопасности
- 🔒 **Не публикуйте** API ключи и токены
- 🛡️ **Ограничьте доступ** к файлам конфигурации  
- 💾 **Делайте бэкапы** базы данных регулярно
- 🔄 **Обновляйте** зависимости периодически

### Настройка прав доступа
```bash
# Ограничение доступа к конфигурации
chmod 600 config/config.yaml
chmod 600 config/channels_config.yaml

# Права на директории
chmod 755 logs/
chmod 755 config/
```

## 📞 Поддержка и разработка

### Полезные ссылки
- 📖 **Telegram Bot API**: https://core.telegram.org/bots/api
- 🔧 **Python Telegram Bot**: https://python-telegram-bot.org/
- 💾 **SQLite документация**: https://sqlite.org/docs.html

### Разработка
```bash
# Установка зависимостей для разработки
pip install -r requirements.txt

# Запуск в режиме отладки
python main_bot.py --debug

# Тестирование
python -m pytest tests/
```

## 📄 Лицензия

MIT License - свободное использование и модификация.

---

## 🎉 Готово к работе!

**Современный Telegram бот для мониторинга новостей с профессиональным UX интерфейсом и мощными возможностями управления!**

### Ключевые преимущества:
- ⚡ **Быстрый старт** - запуск одной командой
- 🎮 **Современный UX** - как в лучших Telegram ботах
- 🔧 **Простое управление** - все функции через интерфейс бота
- 📊 **Полная статистика** - мониторинг работы в реальном времени
- 🚀 **Готов к продакшену** - стабильная работа 24/7

**Начните использовать прямо сейчас!** 🚀