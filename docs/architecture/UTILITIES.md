



–°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞–µ—Ç –Ω–∞–±–æ—Ä –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è, –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –¥–µ–ø–ª–æ—è News Monitor Bot. –£—Ç–∏–ª–∏—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ –∞—Å–ø–µ–∫—Ç—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è: –æ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è.

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `tools/` –ø–∞–ø–∫–∞  
**–î–µ–ø–ª–æ–π**: systemd —Å–µ—Ä–≤–∏—Å + –∫–æ–º–∞–Ω–¥–Ω—ã–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏  
**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: Kill Switch —Å–∏—Å—Ç–µ–º–∞ + –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

---





```
UTILITIES ECOSYSTEM
‚îú‚îÄ‚îÄ Setup & Auth               
‚îÇ   ‚îú‚îÄ‚îÄ setup_user_auth.py    
‚îÇ   ‚îî‚îÄ‚îÄ safe_mode.py          
‚îú‚îÄ‚îÄ Maintenance               
‚îÇ   ‚îú‚îÄ‚îÄ cleanup_database.py   
‚îÇ   ‚îú‚îÄ‚îÄ backup_channels_config.py 
‚îÇ   ‚îî‚îÄ‚îÄ add_news_manual.py    
‚îú‚îÄ‚îÄ Monitoring & Control     
‚îÇ   ‚îú‚îÄ‚îÄ Kill Switch —Å–∏—Å—Ç–µ–º–∞   
‚îÇ   ‚îú‚îÄ‚îÄ Web Interface        
‚îÇ   ‚îî‚îÄ‚îÄ System Commands      
‚îî‚îÄ‚îÄ Deployment              
    ‚îú‚îÄ‚îÄ systemd service      
    ‚îú‚îÄ‚îÄ server_commands.txt  
    ‚îî‚îÄ‚îÄ Environment setup   
```



```python

1. –ê–≤—Ç–æ–Ω–æ–º–Ω–æ—Å—Ç—å - –∫–∞–∂–¥–∞—è —É—Ç–∏–ª–∏—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
2. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏  
3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏
4. –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥ –≥–¥–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
5. –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–º–µ–Ω—ã –æ–ø–∞—Å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
```

---





**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telethon –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è —á—Ç–µ–Ω–∏—è –∫–∞–Ω–∞–ª–æ–≤  
**–§–∞–π–ª**: `tools/setup_user_auth.py` (124 —Å—Ç—Ä–æ–∫–∏)



```bash

python tools/setup_user_auth.py


RESET_TELETHON_SESSION=1 python tools/setup_user_auth.py
```



```python
async def setup_user_authentication():
    """–ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"""
    
    
    api_id = int(os.getenv('TELEGRAM_API_ID'))
    api_hash = os.getenv('TELEGRAM_API_HASH')
    
    
    session_path = repo_root / 'sessions' / 'news_monitor_session'
    client = TelegramClient(str(session_path), api_id, api_hash)
    
    
    await client.start()  
    
    
    me = await client.get_me()
    if hasattr(me, 'phone') and me.phone:
        print("‚úÖ –£–°–ü–ï–®–ù–û! –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞")
        
        
        test_channel = "@SMIzametki"
        entity = await client.get_entity(test_channel)
        
        
        async for message in client.iter_messages(entity, limit=3):
            if message.text:
                print(f"üìÑ –°–æ–æ–±—â–µ–Ω–∏–µ: {message.text[:80]}...")
```



- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏**: –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–µ—Å—Å–∏—è –ù–ï —É–¥–∞–ª—è–µ—Ç—Å—è –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è —á–∞—Å—Ç—ã—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–π
- **–°–±—Ä–æ—Å —Å–µ—Å—Å–∏–∏**: —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `RESET_TELETHON_SESSION=1`  
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏**: —Ä–∞–∑–ª–∏—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç –±–æ—Ç–∞ –ø–æ –Ω–∞–ª–∏—á–∏—é –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–µ–Ω–∏—è –∫–∞–Ω–∞–ª–∞ –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏



**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã –±–µ–∑ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–∞–Ω–∞–ª–æ–≤  
**–§–∞–π–ª**: `tools/safe_mode.py` (58 —Å—Ç—Ä–æ–∫)



```bash

python tools/safe_mode.py
```



```python
async def run_safe_mode():
    """–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –±–µ–∑ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞"""
    
    print("üõ°Ô∏è –ë–ï–ó–û–ü–ê–°–ù–´–ô –†–ï–ñ–ò–ú - –±–µ–∑ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–∞–Ω–∞–ª–æ–≤")
    
    
    db = DatabaseManager("news_monitor.db")
    await db.initialize()
    
    bot = TelegramBot(
        token=config['bot']['token'],
        chat_id=config['bot']['chat_id']
    )
    
    
    if await bot.test_connection():
        await bot.send_message(
            "üõ°Ô∏è –°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—â–µ–Ω–∞ –≤ –ë–ï–ó–û–ü–ê–°–ù–û–ú –†–ï–ñ–ò–ú–ï\n\n"
            "‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞–Ω–∞–ª–æ–≤ –û–¢–ö–õ–Æ–ß–ï–ù\n"
            "üì± –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç\n"  
            "üñ•Ô∏è –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ http://localhost:8080"
        )
```



- ‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è  
- ‚úÖ –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ http://localhost:8080
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚ùå –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞–Ω–∞–ª–æ–≤ **–û–¢–ö–õ–Æ–ß–ï–ù**



- **–û—Ç–ª–∞–¥–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**: –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–µ–∑ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ Telegram API
- **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ**: –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞  
- **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫**: –∏–∑–±–µ–∂–∞–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö rate limits
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**: –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–æ—Ç–∞ –∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

---





**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–º –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π  
**–§–∞–π–ª**: `tools/cleanup_database.py` (155 —Å—Ç—Ä–æ–∫)



```bash

python tools/cleanup_database.py


python tools/cleanup_database.py 3


python tools/cleanup_database.py all
```



```python
async def cleanup_database(days_to_keep: int = 7, clear_all: bool = False):
    """–°–µ–ª–µ–∫—Ç–∏–≤–Ω–∞—è –∏–ª–∏ –ø–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö"""
    
    if clear_all:
        
        confirm = input("–í—ã —É–≤–µ—Ä–µ–Ω—ã? –í–≤–µ–¥–∏—Ç–µ 'YES' –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è: ")
        if confirm != "YES":
            return
            
        
        tables = ['messages', 'sent_digests', 'processed_hashes', 'channel_checks', 'statistics']
        for table in tables:
            result = conn.execute(f"DELETE FROM {table}")
            print(f"üóëÔ∏è –û—á–∏—â–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ {table}: {result.rowcount} –∑–∞–ø–∏—Å–µ–π")
    else:
        
        cutoff_date = datetime.now() - timedelta(days=days_to_keep)
        
        
        result = conn.execute("DELETE FROM messages WHERE created_at < ?", (cutoff_date,))
        print(f"üì∞ –£–¥–∞–ª–µ–Ω–æ —Å—Ç–∞—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π: {result.rowcount}")
        
        
        result = conn.execute("DELETE FROM sent_digests WHERE sent_at < ?", (cutoff_date,))
        print(f"üì® –£–¥–∞–ª–µ–Ω–æ —Å—Ç–∞—Ä—ã—Ö –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤: {result.rowcount}")
        
        
        result = conn.execute("DELETE FROM processed_hashes WHERE first_seen < ?", (cutoff_date,))
        print(f"üîó –£–¥–∞–ª–µ–Ω–æ —Å—Ç–∞—Ä—ã—Ö —Ö—ç—à–µ–π: {result.rowcount}")
        
        
        result = conn.execute("DELETE FROM channel_checks WHERE updated_at < ?", (cutoff_date,))
        print(f"üì∫ –£–¥–∞–ª–µ–Ω–æ —Å—Ç–∞—Ä—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –∫–∞–Ω–∞–ª–æ–≤: {result.rowcount}")
    
    
    conn.execute("VACUUM")
    print("üóúÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–∂–∞—Ç–∞")
```



```python

with db_manager._get_connection() as conn:
    cursor = conn.execute("SELECT COUNT(*) FROM messages")
    messages_count = cursor.fetchone()[0]
    
    cursor = conn.execute("SELECT COUNT(*) FROM sent_digests")  
    digests_count = cursor.fetchone()[0]
    
    print(f"\nüìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–∑—ã:")
    print(f"üì∞ –°–æ–æ–±—â–µ–Ω–∏–π: {messages_count}")
    print(f"üì® –î–∞–π–¥–∂–µ—Å—Ç–æ–≤: {digests_count}")
    
    
    db_size = os.path.getsize(db_path) / 1024 / 1024
    print(f"üíæ –†–∞–∑–º–µ—Ä –±–∞–∑—ã: {db_size:.2f} MB")
```



- **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏**: —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–≤–æ–¥ 'YES' –¥–ª—è –Ω–µ–æ–±—Ä–∞—Ç–∏–º—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞**: —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –ø–µ—Ä–µ–¥ –æ—á–∏—Å—Ç–∫–æ–π
- **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ**: —Å–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ –≤–∞–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –æ–ø–µ—Ä–∞—Ü–∏–µ–π
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞**: –∫–æ–Ω—Ç—Ä–æ–ª—å –æ–±—ä–µ–º–∞ —É–¥–∞–ª—è–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö



**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–µ–π –≤ —Å–∏—Å—Ç–µ–º—É –±–µ–∑ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–∞–Ω–∞–ª–æ–≤  
**–§–∞–π–ª**: `tools/add_news_manual.py` (96 —Å—Ç—Ä–æ–∫)



```bash

python tools/add_news_manual.py
```



```python
async def add_manual_news():
    """–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏"""
    
    print("üí¨ –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏:")
    
    
    title = input("üì∞ –ó–∞–≥–æ–ª–æ–≤–æ–∫: ").strip()
    text = input("üìÑ –¢–µ–∫—Å—Ç –Ω–æ–≤–æ—Å—Ç–∏: ").strip()
    
    
    source = input("üìç –ò—Å—Ç–æ—á–Ω–∏–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é '–†—É—á–Ω–æ–π –≤–≤–æ–¥'): ").strip() or "–†—É—á–Ω–æ–π –≤–≤–æ–¥"
    region = input("üåç –†–µ–≥–∏–æ–Ω (sakhalin/kamchatka/other): ").strip() or "other"  
    url = input("üîó –°—Å—ã–ª–∫–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ): ").strip()
    
    
    now = datetime.now()
    message_data = {
        "id": f"manual_{int(now.timestamp())}",
        "channel_username": "@manual",
        "channel_name": source,
        "text": text,
        "date": now,
        "selected_for_output": True,  
        "ai_score": 10,              
        "ai_priority": "high",       
        "content_hash": f"manual_{now.timestamp()}"
    }
    
    
    await db.save_message(message_data)
    
    if await bot.test_connection():
        message = f"üì∞ **–ù–æ–≤–∞—è –Ω–æ–≤–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∞**\n\n**{title}**\n\n{text}"
        if url:
            message += f"\n\nüîó [–ß–∏—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é]({url})"
        message += f"\n\nüìç {source}"
        
        await bot.send_message(message)
        print("‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram")
```



- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–±–æ—Ä**: `selected_for_output = True` 
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥**: `ai_score = 10`
- **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: `ai_priority = "high"`
- **–£–Ω–∏–∫–∞–ª—å–Ω–∞—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: –ø—Ä–µ—Ñ–∏–∫—Å `manual_` –≤ ID
- **–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ**: –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

---





**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫–∞–Ω–∞–ª–æ–≤  
**–§–∞–π–ª**: `tools/backup_channels_config.py` (65 —Å—Ç—Ä–æ–∫)



```bash

python tools/backup_channels_config.py
```



```python
def backup_channels_config():
    """–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –≤–µ—Ä—Å–∏—è–º–∏"""
    
    
    source = Path('config/channels_config.yaml')
    backup_dir = Path('backups/channels_config')
    backup_dir.mkdir(parents=True, exist_ok=True)
    
    
    timestamp = datetime.now().strftime('%Y-%m-%d_%H-%M-%S')
    backup_name = f'channels_config_{timestamp}.yaml'
    backup_path = backup_dir / backup_name
    
    
    shutil.copy2(source, backup_path)
    
    
    latest_link = backup_dir / 'latest.yaml'
    if latest_link.exists():
        latest_link.unlink()
    shutil.copy2(backup_path, latest_link)  
    
    print(f'‚úÖ –ë—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω: {backup_name}')
    print(f'üìÅ –ü—É—Ç—å: {backup_path}')
    
    
    cleanup_old_backups(backup_dir)
```



```python
def cleanup_old_backups(backup_dir, keep_count=10):
    """–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤"""
    
    backup_files = list(backup_dir.glob('channels_config_*.yaml'))
    
    
    backup_files.sort(key=lambda x: x.stat().st_mtime, reverse=True)
    
    
    for file in backup_files[keep_count:]:
        file.unlink()
        print(f'üóëÔ∏è –£–¥–∞–ª–µ–Ω —Å—Ç–∞—Ä—ã–π –±—ç–∫–∞–ø: {file.name}')
```



```
backups/channels_config/
‚îú‚îÄ‚îÄ channels_config_2025-01-20_14-30-15.yaml
‚îú‚îÄ‚îÄ channels_config_2025-01-20_10-15-22.yaml
‚îú‚îÄ‚îÄ channels_config_2025-01-19_18-45-33.yaml
‚îú‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ latest.yaml ‚Üí –ø–æ—Å–ª–µ–¥–Ω–∏–π –±—ç–∫–∞–ø
```



- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: –¥–æ–±–∞–≤–∏—Ç—å –≤ cron –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **–ü–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏**: —Å–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ –ø–µ—Ä–µ–¥ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- **–ö–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π**: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫–∞–Ω–∞–ª–æ–≤
- **–ë—ã—Å—Ç—Ä–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ latest.yaml –¥–ª—è –æ—Ç–∫–∞—Ç–∞

---





**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ–ª–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã —Å –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ–º –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤  
**–§–∞–π–ª—ã**: `src/handlers/commands/basic.py`, `main.py`



```bash

/kill_switch

"‚úÖ –î–ê, –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–¢–¨"
```



```python

if __name__ == "__main__":
    
    if os.path.exists("STOP_BOT"):
        print("üõë –ù–ê–ô–î–ï–ù –§–ê–ô–õ –ë–õ–û–ö–ò–†–û–í–ö–ò: STOP_BOT")
        print("üö´ –ë–û–¢ –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù –û–¢ –ó–ê–ü–£–°–ö–ê")  
        print("üí° –£–¥–∞–ª–∏—Ç–µ —Ñ–∞–π–ª STOP_BOT –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏")
        exit(0)
    
    asyncio.run(NewsMonitorWithBot().run())


async def confirm_kill_switch(self, message):
    """–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ kill switch"""
    
    
    with open("STOP_BOT", "w") as f:
        f.write(f"Kill Switch activated at {datetime.now()}\n")
        f.write("Bot permanently blocked from starting\n")
    
    
    await self.send_message_with_keyboard(
        "üõë <b>KILL SWITCH –ê–ö–¢–ò–í–ò–†–û–í–ê–ù!</b>\n\n"
        "üîí –§–∞–π–ª –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å–æ–∑–¥–∞–Ω\n"
        "üö´ –ë–æ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –æ—Ç –∑–∞–ø—É—Å–∫–∞\n\n"
        "üí° –î–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏: /unlock",
        keyboard
    )
    
    await asyncio.sleep(3)
    
    
    if self.monitor_bot:
        self.monitor_bot.running = False
    sys.exit(0)
```



```python
async def unlock(self, message: Optional[Dict[str, Any]]) -> None:
    """–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã"""
    try:
        if os.path.exists("STOP_BOT"):
            os.remove("STOP_BOT")
            await self.bot.send_message(
                "üîì <b>–°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞!</b>\n\n"
                "‚úÖ –§–∞–π–ª –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —É–¥–∞–ª–µ–Ω\n"
                "üöÄ –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞\n\n"
                "üí° –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ: <code>systemctl restart news-monitor.service</code>"
            )
        else:
            await self.bot.send_message("‚ÑπÔ∏è –°–∏—Å—Ç–µ–º–∞ –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞")
    except Exception as e:
        await self.bot.send_message(f"‚ùå –û—à–∏–±–∫–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏: {e}")
```



- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏**: Kill Switch –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ü–ï–†–ï–î –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π —Å–∏—Å—Ç–µ–º—ã
- **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞**: –±–ª–æ–∫–∏—Ä—É–µ—Ç systemd –∏ cron –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏
- **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è**: —Ç—Ä–µ–±—É–µ—Ç —è–≤–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ**: graceful shutdown —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º

---





**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –í–µ–±-–ø–∞–Ω–µ–ª—å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã –∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö  
**–§–∞–π–ª**: `src/web_interface.py` (350+ —Å—Ç—Ä–æ–∫)



```python
class WebInterface:
    def __init__(self, database, system_monitor, port: int = 8080):
        self.database = database
        self.system_monitor = system_monitor
        self.port = port
        
        if not FLASK_AVAILABLE:
            logger.warning("‚ö†Ô∏è Flask –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.")
            return
        
        self.setup_flask()
```



```python

@app.route('/')
def index():
    return render_template_string(self.get_main_template())


@app.route('/api/stats')  
def get_stats():
    
    stats = loop.run_until_complete(self.database.get_today_stats())
    system_stats = {
        'memory': self.system_monitor.get_memory_usage(),
        'cpu': self.system_monitor.get_cpu_usage(),
        'disk': self.system_monitor.get_disk_usage()
    }
    
    return jsonify({
        'database': stats,
        'system': system_stats,
        'timestamp': datetime.now().isoformat()
    })


@app.route('/api/news')
def get_news():
    
    
```



- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π, –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤, –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤
- **–°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏**: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU, –ø–∞–º—è—Ç–∏, –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞  
- **–ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏**: —Å–ø–∏—Å–æ–∫ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ä–µ–≥–∏–æ–Ω—É
- **–°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**: —Å—Ç–∞—Ç—É—Å Telegram –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **Live –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ AJAX



```bash

pip install flask


curl http://localhost:8080
```

---





**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π —á–µ—Ä–µ–∑ systemd  
**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –¥–µ–ø–ª–æ–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä



```bash

systemctl start news-monitor.service      
systemctl stop news-monitor.service       
systemctl restart news-monitor.service    
systemctl status news-monitor.service     


systemctl enable news-monitor.service     
systemctl disable news-monitor.service    


journalctl -u news-monitor.service -f     
journalctl -u news-monitor.service --since "1 hour ago"  
```



```ini
[Unit]
Description=News Monitor Bot
After=network.target

[Service]
Type=simple
User=news-monitor
WorkingDirectory=/opt/news-monitor/SMI_tg_bot
ExecStart=/usr/bin/python3 main.py
Restart=always
RestartSec=10
Environment=PYTHONPATH=/opt/news-monitor/SMI_tg_bot

[Install]
WantedBy=multi-user.target
```



**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ–ª–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∫–æ–º–∞–Ω–¥ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–æ–º  
**–§–∞–π–ª**: `server_commands.txt` (255 —Å—Ç—Ä–æ–∫)



```bash

/opt/news-monitor/SMI_tg_bot                    
/opt/news-monitor/SMI_tg_bot/logs/              
/opt/news-monitor/SMI_tg_bot/config/            
/opt/news-monitor/SMI_tg_bot/sessions/          


systemctl restart news-monitor.service         
systemctl status news-monitor.service          


tail -f logs/news_monitor.log                  
grep -i "error" logs/news_monitor.log          
grep "$(date +%Y-%m-%d)" logs/news_monitor.log 


git pull                                       
git status                                     


free -h                                        
df -h                                          
ps aux | grep python                          


rm -f config/subscriptions_cache.json         
rm -f sessions/news_monitor_session.session   
```



```bash

systemctl restart news-monitor.service && tail -f logs/news_monitor.log


git pull && systemctl restart news-monitor.service


rm -f config/subscriptions_cache.json && systemctl restart news-monitor.service


systemctl status news-monitor.service && free -h && df -h && ps aux | grep python
```





```python

logging:
  file: logs/news_monitor.log    
  level: INFO                    


logger.add(
    "logs/news_monitor.log",
    rotation="10 MB",              
    retention="30 days",           
    format="{time:YYYY-MM-DD HH:mm:ss} | {level} | {message}"
)
```



```bash

grep "‚úÖ" logs/news_monitor.log


grep -E "(‚ùå|‚ö†Ô∏è)" logs/news_monitor.log


grep "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" logs/news_monitor.log


grep "Telegram –∫–ª–∏–µ–Ω—Ç" logs/news_monitor.log


grep "üì°.*–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥" logs/news_monitor.log
```



```python

class SystemMonitor:
    def get_memory_usage(self) -> Dict[str, float]:
        """–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –≤ MB"""
        
    def get_cpu_usage(self) -> float:
        """–ó–∞–≥—Ä—É–∑–∫–∞ CPU –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö"""
        
    def get_disk_usage(self) -> Dict[str, float]:  
        """–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞ –≤ GB"""
        
    def get_uptime(self) -> str:
        """–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã"""
```

---







```bash

ls -la STOP_BOT


/unlock


rm STOP_BOT
```



```bash

RESET_TELETHON_SESSION=1 python tools/setup_user_auth.py


rm sessions/news_monitor_session.session
python tools/setup_user_auth.py
```



```bash

ls -lah news_monitor.db


python tools/cleanup_database.py


python tools/cleanup_database.py 7
```



```bash

systemctl status news-monitor.service


tail -50 logs/news_monitor.log


systemctl restart news-monitor.service
```



```bash

grep "wait of.*seconds" logs/news_monitor.log


rm config/subscriptions_cache.json


nano config/config.yaml  
```





```bash

find logs/ -name "*.log.*" -mtime +30 -delete


python tools/cleanup_database.py 14


python tools/backup_channels_config.py


git pull
systemctl restart news-monitor.service
```



```bash

du -sh news_monitor.db


grep -c "‚ùå" logs/news_monitor.log


grep "üìä –ù–∞–π–¥–µ–Ω–æ.*—Å–æ–æ–±—â–µ–Ω–∏–π" logs/news_monitor.log | tail -20


free -h && df -h
```

---





- [ ] **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è**
  ```bash
  git clone <repository_url>
  cd news-monitor-bot
  ```

- [ ] **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**
  ```bash
  pip install -r requirements.txt
  pip install flask  
  ```

- [ ] **–°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞**
  ```bash
  cp env_template.txt .env
  
  ```

- [ ] **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**
  ```bash
  python tools/setup_user_auth.py
  ```

- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º —Ä–µ–∂–∏–º–µ**
  ```bash
  python tools/safe_mode.py
  ```

- [ ] **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ systemd —Å–µ—Ä–≤–∏—Å–∞**
  ```bash
  sudo systemctl enable news-monitor.service
  sudo systemctl start news-monitor.service
  ```



- [ ] **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞**
  ```bash
  systemctl status news-monitor.service
  ```

- [ ] **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏**
  ```bash
  tail -f logs/news_monitor.log
  ```

- [ ] **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**
  ```bash
  curl http://localhost:8080
  ```

- [ ] **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞**
  ```bash
  
  ```

- [ ] **–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –±—ç–∫–∞–ø**
  ```bash
  python tools/backup_channels_config.py
  ```



- [ ] **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–æ—Ç–∞—Ü–∏—é –ª–æ–≥–æ–≤**
- [ ] **–î–æ–±–∞–≤–∏—Ç—å cron –∑–∞–¥–∞—á–∏ –¥–ª—è –±—ç–∫–∞–ø–æ–≤**
- [ ] **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö**  
- [ ] **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏**
- [ ] **–ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—É—Ç–∏ –∏ –ø–∞—Ä–æ–ª–∏**

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Utilities –∞–∫—Ç—É–∞–ª—å–Ω–∞ –Ω–∞: —è–Ω–≤–∞—Ä—å 2025*  
*–ü–æ–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã*
