"""
–¢–µ—Å—Ç AI —Ñ–∏–ª—å—Ç—Ä–∞ —Ä–µ–∫–ª–∞–º—ã/—Å–ø–∞–º–∞
"""
import asyncio
from src.ai.urgency_detector import analyze_news_urgency, initialize_urgency_detector

async def test_ai_spam_filter():
    print("üß™ –¢–ï–°–¢ AI –î–ï–¢–ï–ö–¢–û–†–ê –†–ï–ö–õ–ê–ú–´ (—Å —ç–º–æ–¥–∑–∏ üö´)")
    print("=" * 60)
    
    
    print("üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AI –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞...")
    await initialize_urgency_detector()
    print("‚úÖ AI –¥–µ—Ç–µ–∫—Ç–æ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω\n")
    
    
    test_messages = [
        
        ("–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –ø—Ä—è–º–æ –∑–¥–µ—Å—å ‚Äî –≤–∞—à–∞ —Ä–µ–∫–ª–∞–º–∞. –ï—Å–ª–∏ –≤—ã –¥–µ–ª–∞–µ—Ç–µ –∫–ª–∞—Å—Å–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç –∏ —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã –æ–± —ç—Ç–æ–º —É–∑–Ω–∞–ª–∏ ‚Äî –ø–∏—à–∏—Ç–µ: @reklama_newsmedia2.", "IGNORE"),
        ("–ü—Ä–æ–¥–∞–º –∫–≤–∞—Ä—Ç–∏—Ä—É –≤ —Ü–µ–Ω—Ç—Ä–µ –≥–æ—Ä–æ–¥–∞, –Ω–µ–¥–æ—Ä–æ–≥–æ! –ó–≤–æ–Ω–∏—Ç–µ +7-999-123-45-67", "IGNORE"),
        ("üéâ –ê–ö–¶–ò–Ø! –°–∫–∏–¥–∫–∏ –¥–æ 90% –Ω–∞ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã! –ó–∞–∫–∞–∑—ã–≤–∞–π—Ç–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!", "IGNORE"),
        ("–¢—Ä–µ–±—É–µ—Ç—Å—è –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º. –í—ã—Å–æ–∫–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞. –û–±—Ä–∞—â–∞–π—Ç–µ—Å—å: @work_channel", "IGNORE"),
        ("–ü—Ä–µ–¥–ª–∞–≥–∞—é —É—Å–ª—É–≥–∏ –ø–æ —Ä–µ–º–æ–Ω—Ç—É –∫–≤–∞—Ä—Ç–∏—Ä. –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ –∏ –Ω–µ–¥–æ—Ä–æ–≥–æ. –ü–∏—à–∏—Ç–µ –≤ –ª–∏—á–∫—É", "IGNORE"),
        
        
        ("–¢—Ä–∏ —á–µ–ª–æ–≤–µ–∫–∞ –ø–æ–≥–∏–±–ª–∏ –≤ –î–¢–ü –Ω–∞ —Ç—Ä–∞—Å—Å–µ –ò—Ä–∫—É—Ç—Å–∫-–ß–∏—Ç–∞. –í–æ–¥–∏—Ç–µ–ª—å –ø–æ—Ç–µ—Ä—è–ª —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ", "URGENT"),
        ("–í —Ü–µ–Ω—Ç—Ä–µ –ú–æ—Å–∫–≤—ã –ø—Ä–æ–∏–∑–æ—à–µ–ª –≤–∑—Ä—ã–≤ –≤ –∂–∏–ª–æ–º –¥–æ–º–µ, –µ—Å—Ç—å –ø–æ—Å—Ç—Ä–∞–¥–∞–≤—à–∏–µ", "URGENT"),
        ("–ú—ç—Ä –≥–æ—Ä–æ–¥–∞ –æ–±—ä—è–≤–∏–ª –æ –ø–æ–≤—ã—à–µ–Ω–∏–∏ —Ç–∞—Ä–∏—Ñ–æ–≤ –Ω–∞ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç —Å —è–Ω–≤–∞—Ä—è", "IMPORTANT"),
        ("–ó–∞–≤—Ç—Ä–∞ –≤ –≥–æ—Ä–æ–¥–µ –æ–∂–∏–¥–∞–µ—Ç—Å—è –¥–æ–∂–¥—å —Å –ø–µ—Ä–µ—Ö–æ–¥–æ–º –≤ —Å–Ω–µ–≥, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–æ -5", "NORMAL"),
        ("–ú–µ—Å—Ç–Ω–∞—è —Ñ—É—Ç–±–æ–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –≤—ã–∏–≥—Ä–∞–ª–∞ –º–∞—Ç—á —Å–æ —Å—á–µ—Ç–æ–º 3:1", "NORMAL"),
    ]
    
    print("üìù –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:")
    
    success_count = 0
    total_count = len(test_messages)
    
    for i, (message, expected) in enumerate(test_messages, 1):
        try:
            result = await analyze_news_urgency(message, f"test_channel_{i}")
            actual = result['urgency_level'].upper()
            
            
            if (expected == "IGNORE" and actual == "IGNORE") or \
               (expected != "IGNORE" and actual != "IGNORE"):
                status = "‚úÖ"
                success_count += 1
            else:
                status = "‚ùå"
            
            
            print(f"\n{i:2d}. {status} AI: {actual:8s} | –û–∂–∏–¥–∞–ª—Å—è: {expected:8s}")
            print(f"     üì∞ {message[:80]}{'...' if len(message) > 80 else ''}")
            
            if status == "‚ùå":
                print(f"     ‚ö†Ô∏è  –û—à–∏–±–∫–∞! –û–∂–∏–¥–∞–ª–æ—Å—å: {expected}, –ø–æ–ª—É—á–∏–ª–∏: {actual}")
                
        except Exception as e:
            print(f"\n{i:2d}. ‚ùå –û–®–ò–ë–ö–ê: {e}")
            print(f"     üì∞ {message[:80]}...")
    
    print(f"\n" + "=" * 60)
    print(f"üìä –ò–¢–û–ì–û: {success_count}/{total_count} –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã ({success_count/total_count*100:.1f}%)")
    
    if success_count == total_count:
        print("üéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´! AI –æ—Ç–ª–∏—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∫–ª–∞–º—É!")
    elif success_count >= total_count * 0.8:
        print("‚úÖ –•–û–†–û–®–ò–ô –†–ï–ó–£–õ–¨–¢–ê–¢! –ï—Å—Ç—å –Ω–µ–±–æ–ª—å—à–∏–µ –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç–∏ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏")
    else:
        print("‚ö†Ô∏è  –¢–†–ï–ë–£–Æ–¢–°–Ø –î–û–†–ê–ë–û–¢–ö–ò –≤ AI –ø—Ä–æ–º–ø—Ç–µ")

if __name__ == "__main__":
    asyncio.run(test_ai_spam_filter())
